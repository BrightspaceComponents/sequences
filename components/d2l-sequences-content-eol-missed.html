<link rel="import" href="../../d2l-button/d2l-button.html">
<link rel="import" href="d2l-sequences-content-eol-activity-link.html">
<link rel="import" href="../../polymer/polymer.html">
<link rel="import" href="../../d2l-polymer-siren-behaviors/store/entity-behavior.html">
<link rel="import" href="../localize-behavior.html">
 <dom-module id="d2l-sequences-content-eol-missed">
	<template>
		<style>
			:host {
				color: var(--d2l-color-ferrite);
			}
			.content-eol-missed-container {
				padding-top: 50px;
				text-align: left;
			}

			.content-eol-missed-container > * {
				margin: 25px 0;
			}

			.module-item-list {
				list-style-type: none;
				padding-left: 0px;
			}

			.module-item-list li {
				padding-top: 15px;
				padding-bottom: 15px;
				border-bottom: 1px solid var(--d2l-color-mica);
			}
		</style>
		<div class="content-eol-missed-container">
			<h2>
				[[localize('youMissedThese')]]
			</h2>
			<ol class="module-item-list">
				<template is="dom-repeat" items="[[subEntities]]" as="childLink">
					<li>
						<d2l-sequences-content-eol-activity-link
							href="[[childLink.href]]"
							token="[[token]]"
							on-click="_onChildLinkClick">
						</d2l-sequences-content-eol-activity-link>
					</li>
				</template>
			</ol>
			<d2l-button primary on-click="_onClickBack">
				<label>
					[[localize('imDone')]]
				</label>
			</d2l-button>
		</div>
	</template>
	<script>
		/*
			@extends D2L.PolymerBehaviors.Sequences.LocalizeBehavior
		*/
		class D2LSequencesContentEoLMissed extends Polymer.mixinBehaviors([
				D2L.PolymerBehaviors.Siren.EntityBehavior,
				D2L.PolymerBehaviors.Sequences.LocalizeBehavior
			],
			Polymer.Element
			) {
			static get is() {
				return 'd2l-sequences-content-eol-missed';
			}
			static get properties() {
				return {
					href: {
						type: String,
						reflectToAttribute: true,
						notify: true
					},
					token: {
						type: String
					},
					returnUrl: {
						type: String,
						value: false
					},
					subEntities: {
						type: Object,
						computed: '_getSubEntities(entity)'
					}
				}
			}

			connectedCallback() {
				super.connectedCallback();
				window.top.scrollTo(0,0);
			}

			_onChildLinkClick(e) {
				this.href = e.model.__data.childLink.href;
			}
			_getSubEntities(entity) {
				if (!entity) {
					return [];
				}
				return entity.entities;
			}
			_onClickBack() {
				if ( !this.returnUrl ) {
					return;
				}
				if ( window.parent === window ) {
					window.location.href = this.returnUrl;
					return;
				}

				// If we're in an iframe we need to post a message to do the navigation for us
				window.parent.postMessage(JSON.stringify({
					eventType: 'd2l-sequence-viewer-return',
					returnUrl: this.returnUrl
				}), '*');
			}
		}
		customElements.define(D2LSequencesContentEoLMissed.is, D2LSequencesContentEoLMissed);
	</script>
</dom-module>